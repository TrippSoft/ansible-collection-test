---
name: Release
'on':
  push:
    tags:
      - '*'
defaults:
  run:
    working-directory: 'trippsc2.test'
jobs:
  call-ci-test:
    name: Call CI test workflow
    uses: trippsoft/ansible-collection-test/.github/workflows/ci-test.yml@main
  call-docs-test:
    name: Call Docs test workflow
    uses: trippsoft/ansible-collection-test/.github/workflows/docs-test.yml@main
  release:
    name: Release
    runs-on:
      - self-hosted
      - linux
      - x64
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          path: 'trippsc2.test'
      - name: Release
        run: |
          source ~/venv/ansible-2.16/bin/activate
          ansible-galaxy collection build --force
          ansible-galaxy collection publish --force --token "${ secrets.GALAXY_API_KEY }" *.tar.gz
          rm -rf *.tar.gz
          deactivate
